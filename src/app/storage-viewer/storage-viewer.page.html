<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>ðŸ“¦ Local Storage Viewer</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="loadAllData()">
        <ion-icon slot="icon-only" name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Statistics Bar -->
  <ion-toolbar color="light">
    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <div class="stat-box">
            <div class="stat-label">Transactions</div>
            <div class="stat-value">
              {{ stats().totalTransactions }}
              <span
                class="stat-badge danger"
                *ngIf="stats().unsyncedTransactions > 0"
              >
                {{ stats().unsyncedTransactions }} unsynced
              </span>
            </div>
          </div>
        </ion-col>
        <ion-col size="6">
          <div class="stat-box">
            <div class="stat-label">Exception Logs</div>
            <div class="stat-value">
              {{ stats().totalLogs }}
              <span class="stat-badge danger" *ngIf="stats().unsyncedLogs > 0">
                {{ stats().unsyncedLogs }} unsynced
              </span>
            </div>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>

  <!-- Segment Control -->
  <ion-toolbar>
    <ion-segment
      [value]="selectedSegment()"
      (ionChange)="segmentChanged($event)"
    >
      <ion-segment-button value="transactions">
        <ion-label>Transactions ({{ transactions().length }})</ion-label>
      </ion-segment-button>
      <ion-segment-button value="logs">
        <ion-label>Logs ({{ exceptionLogs().length }})</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading()" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading storage data...</p>
  </div>

  <!-- Transactions View -->
  <div *ngIf="!isLoading() && selectedSegment() === 'transactions'">
    <!-- Empty State -->
    <div *ngIf="transactions().length === 0" class="empty-state">
      <ion-icon name="file-tray-outline" size="large"></ion-icon>
      <h3>No Transactions</h3>
      <p>Local storage is empty</p>
    </div>

    <!-- Transactions List -->
    <ion-list *ngIf="transactions().length > 0">
      <ion-list-header>
        <ion-label>All Transactions</ion-label>
        <ion-button
          size="small"
          color="danger"
          fill="outline"
          (click)="clearAllTransactions()"
        >
          Clear All
        </ion-button>
      </ion-list-header>

      <ion-item-sliding *ngFor="let tx of transactions()">
        <ion-item>
          <ion-label>
            <h2>
              <ion-badge [color]="getStatusColor(tx.status)">
                {{ tx.status }}
              </ion-badge>
              <ion-badge [color]="getSyncColor(tx.isSynced)">
                {{ tx.isSynced ? 'âœ“ Synced' : 'âœ— Unsynced' }}
              </ion-badge>
            </h2>
            <h3>
              <strong>Door:</strong> {{ tx.parkingDoorNumber }} |
              <strong>User:</strong> {{ tx.userName }}
            </h3>
            <p>
              <strong>ID:</strong> {{ tx.id }}<br />
              <strong>Entry:</strong> {{ formatDate(tx.entryTime) }}<br />
              <strong>Exit:</strong> {{ formatDate(tx.exitTime) }}<br />
              <strong>Phone:</strong> {{ tx.phoneNumber }}
            </p>
          </ion-label>
        </ion-item>

        <ion-item-options side="end">
          <ion-item-option color="danger" (click)="deleteTransaction(tx.id)">
            <ion-icon slot="icon-only" name="trash"></ion-icon>
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    </ion-list>
  </div>

  <!-- Exception Logs View -->
  <div *ngIf="!isLoading() && selectedSegment() === 'logs'">
    <!-- Empty State -->
    <div *ngIf="exceptionLogs().length === 0" class="empty-state">
      <ion-icon name="alert-circle-outline" size="large"></ion-icon>
      <h3>No Exception Logs</h3>
      <p>No errors recorded</p>
    </div>

    <!-- Exception Logs List -->
    <ion-list *ngIf="exceptionLogs().length > 0">
      <ion-list-header>
        <ion-label>All Exception Logs</ion-label>
        <ion-button
          size="small"
          color="danger"
          fill="outline"
          (click)="clearAllLogs()"
        >
          Clear All
        </ion-button>
      </ion-list-header>

      <ion-item-sliding *ngFor="let log of exceptionLogs()">
        <ion-item>
          <ion-label>
            <h2>
              <ion-badge color="danger">{{ log.errorType }}</ion-badge>
              <ion-badge [color]="getSyncColor(log.isSynced)">
                {{ log.isSynced ? 'âœ“ Synced' : 'âœ— Unsynced' }}
              </ion-badge>
            </h2>
            <h3>{{ log.message }}</h3>
            <p>
              <strong>ID:</strong> {{ log.id }}<br />
              <strong>Service:</strong> {{ log.serviceName }}<br />
              <strong>Code:</strong> {{ log.code }}<br />
              <strong>Door:</strong> {{ log.parkingDoorNumber }}<br />
              <strong>Timestamp:</strong> {{ formatDate(log.timestamp) }}
            </p>
          </ion-label>
        </ion-item>

        <ion-item-options side="end">
          <ion-item-option color="danger" (click)="deleteLog(log.id)">
            <ion-icon slot="icon-only" name="trash"></ion-icon>
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    </ion-list>
  </div>
</ion-content>
